<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title><%= yield :title %> | shiftplan.com</title>
    <%= stylesheet_link_tag 'jquery-ui/ui-lightness/jquery-ui', 'jquery-ui-colorpicker', 'application' %>
    <!--[if IE]>
      <%= stylesheet_link_tag 'ie' %>
    <![endif]-->

		<style type="text/css">
		table {
			border-collapse: collapse;
		}
		#allocations_by_day {
			width: 100%;

		}
		#allocations_by_day tbody tr {
			height: 60px;
			vertical-align: top;
		}
		th, td {
			padding: 0;
			border: 1px solid black;
		}
		.requirement {
			position: absolute;
			height: 80px;
			width: 20px;
			background-color: yellow;
		}
		.slot {
			height: 15px;
		}
		</style>

    <%= javascript_include_tag 'jquery', 'jquery.form.js', 'date', 'jquery-ui.js', 'jquery-plugin-colorpicker', 'parseuri', :cache => true %>
    <%= yield(:head) %>
    <script type="text/javascript">
		  var requirement_options = {
				grid: [0, 15],
				handles: 's, n'
			};

      $(document).ready(function() {
        // find out which tab to select
        var uri = URI.parse(window.location.href);
        var directory = uri.directory;

        var selected_tab = 0;

        if(directory.search(/^\/workplaces/) > -1) {
          selected_tab = 1;
        } else if(directory.search(/^\/employees/) > -1) {
          selected_tab = 2;
        }

        $('#content').tabs({
          selected: selected_tab
        });

        $('input.colorpicker').colorPicker();

        $('a.dialog').live('click', function(event) {
          event.preventDefault();

          var dialogContainer = $('<div id="dialog"></div>');
          dialogContainer.dialog({
            width:800,
            title: this.title,
            close: function() {
              $(this).dialog('destroy').remove();
            }
          });
          
          $.ajax({
            url: this.href,
            dataType: 'html',
            success: function(data, textStatus) {
              dialogContainer.html(data);
            }
          });
        });

				$('.slot').live('dblclick', function() {
					element = $(this);

					var workplace_id = element.closest('.workplace').attr('data-workplace-id');

					var match = element.attr('data-time').match(/^0?(\d*):(\d{2})/);

					var start_time = new Date();
					start_time.setHours(parseInt(match[1]));
					start_time.setMinutes(parseInt(match[2]));

					var end_time = new Date(start_time);
					end_time.setHours(start_time.getHours() + 1);

					var html = '<div class="requirement unstaffed workplace_' + workplace_id + '"></div>';
					var children = element.children('.requirement').length;
					var minutes = (end_time - start_time) / (60 * 1000);

					element.append($(html).attr('data-quantity', 1).
 					                       attr('data-start-time', [start_time.getHours(), start_time.getMinutes()].join(':')).
					                       attr('data-end-time', [end_time.getHours(), end_time.getMinutes()].join(':')).
																 css({'height': minutes.toString() + 'px', 'margin-left': (children * 20).toString() + 'px'}).
																 resizable(requirement_options));
				});

				$('.requirement').live('dblclick', function() {
					$(this).append('<form class="edit_requirement"><label for="quantity">Quantity</label><input id="quantity" type="text" /></form>');
				});

				$('.requirement').resizable(requirement_options);
        <%= yield(:jquery) %>
      });
    </script>
  </head>
  <body>
    <div>
      <%- if flash[:notice] -%>
        <div id="flash" class="notice"><%= flash[:notice] %></div>
      <%- elsif flash[:error] -%>
        <div id="flash" class="error"><%= flash[:error] %></div>
      <%- end -%>
    </div>
		<div id="content">
	    <ul id="navigation">
	      <li><%= link_to t(:overview), root_path %></li>
	      <li><%= link_to t(:workplaces), workplaces_path %></li>
				<li><%= link_to t(:employees), employees_path %></li>
				<li><%= link_to t(:allocations), allocations_path %></li>
	    </ul>
		</div>
  </body>
</html>
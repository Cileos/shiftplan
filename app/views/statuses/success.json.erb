{
  'flash': {
    'notice': '<%= escape_javascript(flash[:notice]) %>'
  },
  'status': <%=raw @status.to_json %>,
<% if @status.default? -%>
<%
# FIXME ugly
employee = @status.employee
day_of_week = @status.day_of_week
default_statuses = employee.statuses.default.group_by(&:day_of_week)
%>
  'html': {
    'replace': {
      '#<%= "#{dom_id(employee)}_day_#{day_of_week}" %>': '<%= escape_javascript(render(:partial => 'default_statuses/day',
              :locals => {
                :employee => employee,
                :day_of_week => day_of_week,
                :statuses => Status.fill_gaps!(employee, day_of_week, default_statuses[day_of_week]) })) %>'
    }
  }
<% else -%>
  'html': {
    'replace': {
      '#<%= "#{dom_id(@status.employee)}_#{@status.day.to_s(:number)}" %> ul': '<%= escape_javascript(render(:partial => 'statuses/statuses',
              :locals => { :statuses => statuses_for(@status.day, @status.employee.statuses.override.all) })) %>'
    }
  }
<% end -%>
}

#!/bin/bash

. script/_lib

ret=$((0))

# run bundle install only if bundle check misses something
# taking out the --relock as we don't change the Gemfile.lock
bundle check || bundle install || ret=$(($ret+1))

header "rSpec"
bundle exec rspec --color ./spec                                 || ret=$(($ret+2))

header "Jasmine"
xvfb-run bundle exec guard-jasmine                               || ret=$(($ret+4))

header "Cucumber (non-javascript)"
bundle exec cucumber --profile ci -t ~@javascript features       || ret=$(($ret+8))

header "Cucumber with chrome"
CAPYBARA_CHROME=yes bundle exec cucumber --profile ci -t @javascript features || ret=$(($ret+16))

header "Cucumber with firefox"
bundle exec cucumber --profile ci -t @javascript features                     || ret=$(($ret+32))

header "Done (exit code: $ret)"
exit $ret
